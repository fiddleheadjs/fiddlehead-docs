<!doctype html>
<html>

<head>
    <script type="text/javascript">
        window.playground = {};

        playground.require = function (moduleName) {
            if (playground_modules[moduleName] !== undefined) {
                return playground_modules[moduleName];
            }

            if (moduleName.startsWith('./')) {
                var fname = moduleName.substring(2);

                if (playground_src.codes[fname] !== undefined) {
                    return playground.runModule(playground_src.codes[fname]);
                }

                var skippableExtensions = ['js', 'jsx', 'ts', 'tsx'];
                var i, filename;
                for (i = 0; i < skippableExtensions.length; i++) {
                    filename = fname + '.' + skippableExtensions[i];
                    if (playground_src.codes[filename] !== undefined) {
                        return playground.runModule(playground_src.codes[filename]);
                    }
                }
            }

            throw new Error('Module not found: ' + moduleName);
        };

        playground.runModule = function (displayCode) {
            var jsxImportCode = "import {jsx as _jsx} from 'fiddlehead';";

            var inputCode = jsxImportCode + '\r\n' + displayCode;

            var outputCode = playground_modules.babel.transform(inputCode, {
                sourceType: 'module',
                presets: [
                    'env',
                ],
                plugins: [
                    ['transform-react-jsx', {
                        pragma: '_jsx',
                        pragmaFrag: '"["',
                    }]
                ],
            }).code;

            var execute = new Function('require', 'exports', outputCode);

            var exports = {};

            execute(playground.require, exports);

            return exports;
        };

        playground.run = function () {
            var entryCode = playground_src.codes[playground_src.entryFilename];

            var exports = playground.runModule(entryCode);
            
            var jsxElement = playground_modules.fiddlehead.jsx(exports.default, null);

            var rootNative = document.createElement('div');

            playground_modules.fiddlehead.render(jsxElement, rootNative);

            while (document.body.firstChild !== null) {
                document.body.removeChild(document.body.firstChild);
            }

            document.body.appendChild(rootNative);
        };
    </script>
</head>

<body>
</body>

</html>
